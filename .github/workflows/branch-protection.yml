name: Branch Protection

on:
  pull_request:
    branches:
      - main
      - develop
    types: [opened, synchronize, reopened]

jobs:
  require-review:
    runs-on: ubuntu-latest
    
    steps:
    - name: Check PR approval status
      uses: actions/github-script@v7
      with:
        script: |
          const pr = context.payload.pull_request;
          const reviews = await github.rest.pulls.listReviews({
            owner: context.repo.owner,
            repo: context.repo.repo,
            pull_number: pr.number,
          });
          
          const approvedReviews = reviews.data.filter(review => review.state === 'APPROVED');
          
          if (approvedReviews.length === 0) {
            core.setFailed('This PR requires at least one approval before merging to main or develop branch');
          } else {
            core.info(`PR has ${approvedReviews.length} approval(s)`);
          }
          
    - name: Branch protection notice
      run: |
        echo "âœ… Branch protection check completed"
        echo "Note: To enforce this requirement, configure branch protection rules in repository settings:"
        echo "  - Go to Settings > Branches > Add branch protection rule"
        echo "  - Add rules for 'main' and 'develop' branches"
        echo "  - Enable 'Require a pull request before merging'"
        echo "  - Enable 'Require approvals' (minimum 1)"
